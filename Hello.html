<!DOCTYPE html>
<html>
<head>
<style type="text/css">
#myCanvas {
	position: absolute;
	top: 0px;
	left: 0px;
	right: 0px;
	bottom: 0px;
	width: 100%;
	height: 100%;
}
</style>
<script type="text/javascript" src="shootingEditor.js"></script>
<script type="text/javascript" src="particleDrawers.js"></script>
<script type="text/javascript">

window.onload = function(){
	init();   
}

var c;
var ctx;
var w;
var h;
var gm = new GameManager();
function GameManager(){
	this.FPS=30;
	this.particleGroup=[];
	this.startTime=new Date().getTime();
}
function init(){
	c = document.getElementById("myCanvas");
	ctx = this.c.getContext("2d");
	w = this.c.width;
	h = this.c.height;
	var pg0 = createBasicGroup();
	
	gm.particleGroup.push(pg0);
	 setInterval(function() {
         update();
         draw();
     }, 1000/gm.FPS);
}


function update(){
	var now = new Date().getTime();
	if(now%20>10){
		var pg0 = createBasicGroup();
		gm.particleGroup.push(pg0);
	}
	updatePosition();
	updateFunction();
}
function updateFunction(){
	for(var i=0;i<gm.particleGroup.length;i++){
		if(gm.particleGroup[i]==null){
            continue;
		}
		for(var j=0;j<gm.particleGroup[i].pattern.length;j++){
			var now = new Date().getTime();
            if(now > gm.particleGroup[i].pattern[j].startTime+gm.particleGroup[i].bornTime){
            	gm.particleGroup[i] = gm.particleGroup[i].pattern[j].callback(gm.particleGroup[i]);
            	gm.particleGroup[i].pattern.splice(j,1);
            	break;
            }
		}
	}
	
}
function updatePosition(){
	var nullCount2 = 0;
	for(var i=0;i<gm.particleGroup.length;i++){
		if(gm.particleGroup[i]==null){
			nullCount2++;
            continue;
		}
		var nullCount=0;
		for(var j=0;j<gm.particleGroup[i].particle.length;j++){
			if(gm.particleGroup[i].particle[j]==null){
				nullCount++;
				continue;
			}
			gm.particleGroup[i].particle[j].x += gm.particleGroup[i].particle[j].sx;
			gm.particleGroup[i].particle[j].y += gm.particleGroup[i].particle[j].sy;
			if(gm.particleGroup[i].particle[j].x>2||gm.particleGroup[i].particle[j].x<-1||gm.particleGroup[i].particle[j].y>2||gm.particleGroup[i].particle[j].y<-1){
				gm.particleGroup[i].particle[j]=null;
				continue;
			}
			gm.particleGroup[i].particle[j].sx += gm.particleGroup[i].particle[j].ax;
			gm.particleGroup[i].particle[j].sy += gm.particleGroup[i].particle[j].ay;
			gm.particleGroup[i].particle[j].ax = 0;//(gm.particleGroup[i].particle[j].tx*w-gm.particleGroup[i].particle[j].x)>0?0.01:-0.01;
			gm.particleGroup[i].particle[j].ay = 0;//(gm.particleGroup[i].particle[j].ty*h-gm.particleGroup[i].particle[j].y)>0?0.01:-0.01;			
		}
		if(gm.particleGroup[i].particle.length==nullCount){
			gm.particleGroup[i]=null;
		}
	}
	for(var i=gm.particleGroup.length-1;i>=0;i--){
         if(gm.particleGroup[i]==null){
        	 gm.particleGroup.splice( i, 1 );
         }
	}
}
function draw(){
	ctx.clearRect ( 0 , 0 , w , h );
	drawArc(ctx,50,50,50,w,h);
	for(var i=0;i<gm.particleGroup.length;i++){
		if(gm.particleGroup[i]==null){
            continue;
		}
		for(var j=0;j<gm.particleGroup[i].particle.length;j++){
			if(gm.particleGroup[i].particle[j]==null){
                 continue;
			}
			drawArc(ctx,gm.particleGroup[i].particle[j].x,gm.particleGroup[i].particle[j].y,gm.particleGroup[i].particle[j].r,w,h);
		}
	}
}
</script>
</head>
<body>

<canvas id="myCanvas">
Your browser does not support the HTML5 canvas tag.
</canvas>

</body>
</html>
